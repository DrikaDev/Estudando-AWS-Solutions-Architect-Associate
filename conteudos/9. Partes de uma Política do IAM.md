## Partes de uma Pol√≠tica do IAM

As pol√≠ticas do IAM s√£o armazenadas na AWS como **documentos JSON**.  
Cada *declara√ß√£o* (statement) dentro da pol√≠tica representa uma √∫nica permiss√£o.  
Quando uma pol√≠tica cont√©m v√°rias declara√ß√µes, a AWS aplica uma opera√ß√£o l√≥gica **OR** entre elas durante a avalia√ß√£o.

## üß© Elementos de uma Pol√≠tica do IAM

A seguir est√£o os elementos comuns encontrados em um documento de pol√≠tica:

<img width="615" height="279" alt="image" src="https://github.com/user-attachments/assets/9941990e-7ad4-4a38-b3e1-243d1a22466c" />

### **1. Version**
Define a vers√£o da linguagem de pol√≠ticas usada.  
Geralmente: `"2012-10-17"`.

### **2. Statement**
Bloco principal que agrupa as permiss√µes.  
Uma mesma pol√≠tica pode conter m√∫ltiplos statements.

### **3. Effect**
Determina se a permiss√£o **Permite (`Allow`)** ou **Nega (`Deny`)** acesso.

### **4. Principal**
Especifica quem pode acessar o recurso.  
Usado **apenas em pol√≠ticas baseadas em recurso** (ex: S3 bucket policy).  
Em pol√≠ticas anexadas a usu√°rios ou perfis do IAM, esse elemento **n√£o √© permitido**, pois a entidade principal j√° √© impl√≠cita.

### **5. Action**
Lista de a√ß√µes que a pol√≠tica permite ou nega.  
Exemplo:  
- `s3:GetObject`  
- `dynamodb:PutItem`  
- `iam:CreateAccessKey`  

> Tamb√©m pode incluir curingas `*` para indicar a√ß√µes relacionadas.

### **6. Resource**
Especifica os recursos aos quais as a√ß√µes se aplicam.  
Obrigat√≥rio em pol√≠ticas baseadas em identidade; opcional em pol√≠ticas baseadas em recurso.

### **7. Condition (opcional)**
Define condi√ß√µes espec√≠ficas nas quais a permiss√£o √© concedida ou negada.  
Permite controles adicionais, como:
- IP de origem  
- Recurso acessado  
- Tag associada  
- M√©todo de autentica√ß√£o  

## üéõÔ∏è Combina√ß√£o de Permiss√µes

Uma pol√≠tica do IAM pode usar, ao mesmo tempo, **permiss√µes expl√≠citas** e **nega√ß√µes expl√≠citas** para limitar o acesso dentro de uma conta AWS.  
Essa combina√ß√£o permite conceder acesso apenas ao que √© realmente necess√°rio, mantendo todo o restante bloqueado.

### üéØ Exemplo de pol√≠tica baseada em recurso

<img width="617" height="308" alt="image" src="https://github.com/user-attachments/assets/dba0adcd-c0b8-4615-a0d8-8587539c8615" />

No exemplo apresentado, a pol√≠tica concede acesso **somente** aos recursos abaixo:

- Notas do curso em uma tabela do **Amazon DynamoDB**  
- Notas do curso em formato web e o arquivo **MP3** armazenados em buckets do **Amazon S3**

### ‚ùå Uso de `Deny` + `NotResource`

A pol√≠tica utiliza uma declara√ß√£o de nega√ß√£o expl√≠cita (`"Effect": "Deny"`) com o elemento **NotResource** para garantir que:

- Os usu√°rios **n√£o possam realizar nenhuma outra a√ß√£o**  
- Nem acessar **qualquer outro recurso** do DynamoDB ou do S3  
- Mesmo que outra pol√≠tica conceda permiss√µes mais amplas

Como regra, uma **nega√ß√£o expl√≠cita sempre tem preced√™ncia** sobre qualquer permiss√£o expl√≠cita.

### üîê Resultado Final

O comportamento final da pol√≠tica √©:

- **Permitir** acesso apenas aos recursos espec√≠ficos listados  
- **Negar** automaticamente todo e qualquer acesso a outros recursos do DynamoDB e do S3 na conta  

Essa abordagem refor√ßa o princ√≠pio do **menor privil√©gio**, garantindo que os usu√°rios tenham acesso somente ao que foi definido de forma expl√≠cita.

## Exemplo de pol√≠tica baseada em identidade

<img width="612" height="254" alt="image" src="https://github.com/user-attachments/assets/3fab396a-859c-4474-870c-930bcac98e9f" />

Ap√≥s anexar uma pol√≠tica baseada em identidade a um usu√°rio, grupo ou perfil, a pol√≠tica **permite ou nega** a√ß√µes para essa entidade.

### üìå Exemplo de permiss√µes (caso anexada a um usu√°rio):

O usu√°rio poderia:

- Criar, excluir, obter ou atualizar sua pr√≥pria senha (a√ß√µes `LoginProfile` do IAM)  
- Criar, excluir, listar ou atualizar sua pr√≥pria *access key* (`AccessKey`)  
- Criar, excluir, obter, listar ou atualizar suas pr√≥prias chaves SSH (`SSHPublicKey`)

### ‚ú® Uso de curingas

A pol√≠tica usa `*` para agrupar a√ß√µes relacionadas, por exemplo:  
`"iam:CreateAccessKey*"`.

### üîó Recursos din√¢micos
A pol√≠tica pode obter o nome do usu√°rio dinamicamente usando vari√°veis na chave `Resource`.

### üéØ Escopo da Pol√≠tica

O exemplo citado concede acesso apenas aos seguintes recursos:

- **Notas do curso** em uma tabela do DynamoDB  
- **Notas do curso (web)** e o **arquivo .mp3** armazenados em buckets do S3  

### ‚õî Nega√ß√£o expl√≠cita

A pol√≠tica cont√©m um *Effect: Deny* usando `NotResource` para garantir que o usu√°rio:

- **n√£o** possa usar a√ß√µes em *outros* recursos do DynamoDB  
- **n√£o** possa acessar *outros* buckets do S3  

Mesmo que outra pol√≠tica permita essas a√ß√µes, a nega√ß√£o expl√≠cita desta pol√≠tica **sempre vence**.

‚û°Ô∏è Resultado:  
O usu√°rio tem acesso **somente** aos recursos espec√≠ficos definidos e √© bloqueado em todos os demais.

## Pol√≠ticas Baseadas em Recurso ‚Äî Exemplo de Acesso Entre Contas

Este exemplo mostra uma **pol√≠tica baseada em recurso** usada para permitir acesso entre contas AWS.

<img width="610" height="267" alt="image" src="https://github.com/user-attachments/assets/9f5578d9-8830-452f-ba4e-ec702f19daa1" />

### üìå Cen√°rio:
- **Conta A** possui um bucket S3 chamado `DOC-EXAMPLE-BUCKET`.
- Conta A cria uma *bucket policy* permitindo que a **Conta B** (ID `111122223333`) execute **qualquer a√ß√£o** do S3 (`"Action": "*"`) neste bucket.

A pol√≠tica n√£o especifica usu√°rios ou grupos ‚Äî apenas a **conta**.

### üîÅ Permiss√£o completa requer duas partes
Para que um usu√°rio da Conta B consiga acessar o bucket da Conta A:

1. Conta A deve permitir acesso atrav√©s da pol√≠tica baseada em recurso (*j√° existe*).  
2. Conta B deve criar uma pol√≠tica baseada em identidade permitindo que seu usu√°rio utilize as a√ß√µes necess√°rias do S3.

‚û°Ô∏è Somente com **ambas as pol√≠ticas** o acesso entre contas ser√° permitido.

## IAM Policy Simulator

O **IAM Policy Simulator** √© uma ferramenta oficial da AWS que permite testar pol√≠ticas antes de aplic√°-las em usu√°rios, grupos ou roles.  
Com ele, √© poss√≠vel validar se uma permiss√£o funcionar√° como esperado, sem afetar recursos reais.

### Para que serve

O Policy Simulator permite:

- Verificar se a√ß√µes est√£o permitidas ou negadas.  
- Identificar conflitos entre pol√≠ticas.  
- Validar permiss√µes antes de mover algo para produ√ß√£o.  
- Visualizar qual pol√≠tica est√° impactando uma a√ß√£o espec√≠fica.  
- Testar diferentes combina√ß√µes de pol√≠ticas de forma segura.

### Quando utilizar

Use o simulador quando:

- Estiver criando uma pol√≠tica do zero.  
- Ajustar permiss√µes sens√≠veis.  
- Receber erros de "Access Denied" e precisar identificar o motivo.  
- Quiser validar o comportamento de allow/deny em m√∫ltiplas pol√≠ticas.

### Como acessar

No console da AWS procure pelo `IAM / Policy Simulator `
Ou procure por: **IAM Policy Simulator**

---

üëâüèª [Clique aqui para voltar ao Readme](https://github.com/DrikaDev/Estudando-AWS-Solutions-Architect-Associate/blob/main/README.md) üìí
